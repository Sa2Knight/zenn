---
title: "	 @babel/plugin-transform-runtime ã‚’ç†è§£ã™ã‚‹(Babel 7)"
emoji: "ğŸ•"
type: "tech"
topics:
  - "babel"
published: true
published_at: "2021-09-17 11:45"
---

# æ¦‚è¦

Babelã®ä¸»è¦ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä¸€ã¤ã§ã‚ã‚‹ã€[@babel/plugin-transform-runtime](https://babeljs.io/docs/en/babel-plugin-transform-runtime) ã«é–¢ã—ã¦ã€é›°å›²æ°—ã§ä½¿ã‚ãšã«ç†è§£ã‚’æ·±ã‚ã‚‹ãŸã‚ã«ã¾ã¨ã‚ãŸå†…å®¹ã§ã™ã€‚

æ¦‚ã­ä¸Šè¨˜å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ã‚ã‚‹å†…å®¹ã‚’è¦ç´„ã—ãŸã ã‘ã«ãªã‚Šã¾ã™ã€‚

:::message
æœ¬è¨˜äº‹ã¯2020å¹´5æœˆã«å€‹äººãƒ–ãƒ­ã‚°ã«æ›¸ã„ã¦ãŸå†…å®¹ã‚’ç§»å‹•ã—ãŸã‚‚ã®ã§ã™ã€‚æœ€æ–°ã®çŠ¶æ…‹ã¨ã¯ç•°ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
:::

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±

ä»¥ä¸‹ã§å‹•ä½œç¢ºèªæ¸ˆã¿

- `Node` v12.16.3
- `@babel/core` v7.4.5
- `@babel/plugin-transform-runtime` v7.4.5
- `@babel/runtime@` v7.9.2
- `core-js` v3.x

# `@babel/plugin-transform-runtime` is ä½•

æœ¬æ¥ã¯Babelã«ã‚ˆã£ã¦æ³¨å…¥ã•ã‚Œã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ã€å†åˆ©ç”¨å¯èƒ½ãªãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹å½¢ã«å¤‰æ›ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã‚°ãƒ­ãƒ¼ãƒãƒ«æ±šæŸ“ã‚’é¿ã‘ãªãŒã‚‰ã€æˆæœç‰©ã®ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã‚’å°ã•ãã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

> ES6+ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã®ä½¿ç”¨ã«ã¯`core-js@3`ãŒåˆ¥é€”å¿…è¦ã§ã™ã€‚`@babel/preset-env`ã®`useBuiltIns`ã‚’è¨­å®šã™ã‚‹ã®ãŒæ‰‹ã£å–ã‚Šæ—©ã„ã§ã™ãŒã“ã“ã§ã¯å‰²æ„›ã—ã¾ã™

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

`@babel/plugin-transform-runtime` ã¯ã‚³ãƒ¼ãƒ‰ãƒ“ãƒ«ãƒ‰æ™‚ã«å¿…è¦ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ãªã‚‹ã®ã§ã€devDependencyã§å……åˆ†ã§ã™ã€‚

```bash
$ yarn add -D @babel/plugin-transform-runtime
```

ãƒ“ãƒ«ãƒ‰å¾Œã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼æœ¬ä½“ãŒåˆ¥é€”å¿…è¦ã«ãªã‚Šã¾ã™ã€‚ã“ã¡ã‚‰ã¯å®Ÿè¡Œç”¨ãªã®ã§productionDependencyã«ãªã‚Šã¾ã™ã€‚

```bash
$ yarn add @babel/runtime
```

# è¨­å®š

`.babelrc`ãªã©ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å†…ã«ä½¿ç”¨ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã€‚ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚è±Šå¯Œã§ã™ãŒã€åŸºæœ¬çš„ã«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å•é¡Œç„¡ã•ãã†ã€‚

```json
{
  "plugins": ["@babel/plugin-transform-runtime"]
}
```

# ãªãœå¿…è¦ãªã®ã‹

Babelã¯é€šå¸¸ã€ä¸€èˆ¬çš„ã«ã‚ˆãä½¿ã‚ã‚Œã‚‹é–¢æ•°(Classç”Ÿæˆãªã©)ã«å¯¾ã—ã¦ã€éƒ½åº¦ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’ç”Ÿæˆã—ã¾ã™ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒåˆ†æ•£ã—ã¦ã„ã‚‹å ´åˆã€ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’å¿…è¦ã¨ã™ã‚‹ãã‚Œãã‚Œã«å¯¾ã—ã¦åŒæ§˜ã®ã‚³ãƒ¼ãƒ‰ã‚’è¤‡è£½ã—ã¦ã—ã¾ã„ã¾ã™ã€‚

ãã†ã™ã‚‹ã¨è¤‡è£½ã—ãŸã‚³ãƒ¼ãƒ‰ãŒæºœã¾ã£ã¦ã„ãã€å…¨ä½“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãããªã£ã¦ã—ã¾ã„ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸèª­ã¿è¾¼ã¿æ™‚é–“ãŒé•·ããªã‚‹å•é¡Œã«ç¹‹ãŒã£ã¦ã—ã¾ã„ã¾ã™ã€‚

ãã“ã§ `@babel/plugin-transform-runtime` ã‚’ç”¨ã„ã‚‹ã¨ã€ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’å¿…è¦ã¨ã™ã‚‹ãã‚Œãã‚Œã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’å®šç¾©ã™ã‚‹ã®ã§ãªãã€`@babel/runtime` ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã•ã‚Œã¾ã™ã€‚å¿…è¦ãªé–¢æ•°ã¯å…¨ã¦ `@babel/runtime` ã«é…ç½®ã—ã¦ã‚ã‚‹ã®ã§ã€ã‚³ãƒ¼ãƒ‰ãŒã©ã‚Œã ã‘åˆ†æ•£ã—ã¦ã„ã¦ã‚‚å…¨ä½“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã«å½±éŸ¿ã‚’ä¸ãˆã¾ã›ã‚“ã€‚

ã¾ãŸã€`@babel/plugin-transform-runtime` ã‚’ä½¿ã‚ãšã«ã€`babel/polyfill`ãªã©ã‚’ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦å¤‰æ›ã™ã‚‹ã¨ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«æ±šæŸ“ãŒç™ºç”Ÿã—ã€ãã®ã‚³ãƒ¼ãƒ‰ã‚’å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ãŸä»–ã®ã‚³ãƒ¼ãƒ‰ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ (é€†ã«è¨€ãˆã°ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚Œã°å¤§ã—ãŸå•é¡Œã«ã¯ãªã‚‰ãªã„)

# CLIã§æŒ™å‹•ã‚’è¦‹ã‚‹

å®Ÿéš›ã®æŒ™å‹•ã‚’CLIã§ç¢ºèªã™ã‚‹ã¨ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ¹§ãã®ã§ã€ã¾ãš`babel-cli`ã¨ã€`preset-env`ã€`core-js`ã‚‚ç”¨æ„ã—ã¦ãŠãã¾ã™ã€‚

```bash
$ yarn add @babel/core
$ yarn add -D @babel/cli @babel/preset-env core-js@3
```

babelã®è¨­å®šã¯å¿…è¦æœ€ä½é™ã«ã€‚ã¨ã‚Šã‚ãˆãš IE11 ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«ã—ã¦ãŠã‘ã°ã ã„ãŸã„ã®ã‚³ãƒ¼ãƒ‰ã¯ polyfill ã•ã‚Œã¾ã™ã€‚

```json
{
  "presets": [
    ["@babel/preset-env", {
      "modules": false,
      "targets": {
        "browsers": "> 1%",
	"ie": 11
      },
      "corejs": {
        "version": 3,
        "proposals": false
      },
      "useBuiltIns": "usage"
    }]
  ],
  "plugins": [
  ]
}
```

æ¤œè¨¼å¯¾è±¡ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã€ã‚¯ãƒ©ã‚¹ã‚’é€šã˜ã¦æ–‡å­—åˆ—ã‚’å‡ºåŠ›ã™ã‚‹ç¨‹åº¦ã®ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

```javascript
class Human {
  constructor(name) {
    this.name = name
  }
  sayHello() {
    return `Hello, ${this.name}`
  }
}

const human = new Human('sasaki')
console.log(human.sayHello())
```

babel-cliã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€es5ã«å¤‰æ›ã•ã‚Œã¾ã™ã€‚

```bash
$ yarn babel script.js
```

```javascript
import "core-js/modules/es.function.name";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var Human = /*#__PURE__*/function () {
  function Human(name) {
    _classCallCheck(this, Human);

    this.name = name;
  }

  _createClass(Human, [{
    key: "sayHello",
    value: function sayHello() {
      return "Hello, ".concat(this.name);
    }
  }]);

  return Human;
}();

var human = new Human('sasaki');
console.log(human.sayHello());
```

ç‰¹ç­†ã™ã¹ãã¯ã€ `_classCallCheck` `_defineProperties` `_createClass` ã¨è¨€ã£ãŸã€ES5ã§ES6+ç›¸å½“ã¨åŒç­‰ã®ä»•çµ„ã¿ã‚’æä¾›ã™ã‚‹ãŸã‚ã«babel(æ­£ç¢ºã«ã¯babelãƒ—ãƒ©ã‚°ã‚¤ãƒ³)ãŒç”Ÿæˆã—ãŸãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã§ã™ã€‚

ã§ã¯æ¬¡ã«ã€ `@babel/plugin-transform-runtime` ã‚’æœ‰åŠ¹ã«ã—ã¦ã¿ã¾ã™ã€‚

```bash
$ yarn babel --plugins @babel/plugin-transform-runtime script.js
```

```javascript
import "core-js/modules/es.function.name";
import _classCallCheck from "@babel/runtime/helpers/classCallCheck";
import _createClass from "@babel/runtime/helpers/createClass";

var Human = /*#__PURE__*/function () {
  function Human(name) {
    _classCallCheck(this, Human);

    this.name = name;
  }

  _createClass(Human, [{
    key: "sayHello",
    value: function sayHello() {
      return "Hello, ".concat(this.name);
    }
  }]);

  return Human;
}();

var human = new Human('sasaki');
console.log(human.sayHello());
```

ãŠã‚„ï¼Ÿ å…ˆç¨‹ã¾ã§ç›´æ¥ç”Ÿæˆã•ã‚Œã¦ã„ãŸãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚³ãƒ¼ãƒ‰ãŒã€ 

```javascript
import _classCallCheck from "@babel/runtime/helpers/classCallCheck";`
```
ã®ã‚ˆã†ã«ã€ä»–ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«æŒ¯ã‚‹èˆã„ãŒå¤‰ã‚ã£ã¦ã„ã¾ã™ã­ã€‚

ã§ã¯ã“ã® `@babel/runtime/helpers/classCallCheck` ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```javascript
function _classCallCheck(instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
}

module.exports = _classCallCheck;
```

æœ¬æ¥ã¯å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¦ã„ãŸã‚³ãƒ¼ãƒ‰ãŒã“ã¡ã‚‰ã«é…ç½®ã•ã‚Œã¦ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

ã“ã‚ŒãŒ `@babel/plugin-transform-runtime` ã®ã»ã‹ã« `@babel/runtime` ã‚’ã€ãã‚Œã‚‚Productionã«å…¥ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã¯ã“ã†ã„ã†ãƒ¯ã‚±ã§ã—ãŸã€‚
