---
title: "Rubyã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¦ªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å–å¾—ã™ã‚‹"
emoji: "ðŸ’Ž"
type: "tech"
topics:
  - "rails"
  - "ruby"
published: true
published_at: "2020-10-21 07:45"
---

# æ¦‚è¦

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®éšŽå±¤ãŒã‚ã‚‹ã¨ãã«ã€`Child`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰`Parent`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®`VALUE`ã‚’å‚ç…§ã—ãŸã‹ã£ãŸã€‚

```ruby
module Parent
  VALUE = 'PARENT'

  module Child
    VALUE = 'CHILD'

    def self.parent_value
      # 'PARENT' ãŒã»ã—ã„
    end
  end
end
```

# Rails(activesupport) ãŒä½¿ãˆã‚‹ç’°å¢ƒãªã‚‰ç°¡å˜

æµçŸ³ã« `Module#parent` çš„ãªãƒ¡ã‚½ãƒƒãƒ‰ãŒRubyã§æä¾›ã•ã‚Œã¦ã‚‹ã ã‚ã†ã¨æ€ã„èª¿ã¹ã¦è¦‹ãŸãŒã€ã©ã†ã‚„ã‚‰Ruby(2.7ç¾åœ¨)æœ¬ä½“ã«ã¯ãã®ã‚ˆã†ãªæ©Ÿèƒ½ã¯ãªãã€`Rails` ã®æ‹¡å¼µ(`activesupport`)ã§æä¾›ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸã€‚

[Module#parent](https://apidock.com/rails/Module/parent)

ãã®ãŸã‚ã€Railsç’°å¢ƒã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å˜ç´”ã«`parent`ã‚’å‚ç…§ã™ã‚‹ã“ã¨ã§å¯¾å¿œå¯èƒ½

```ruby
module Parent
  VALUE = 'PARENT'

  module Child
    VALUE = 'CHILD'

    def self.parent_value
      self.parent::VALUE
    end
  end
end
```

```bash
[4] pry(main)> Parent::Child.parent_value
=> "PARENT"
```

# Railsä»¥å¤–ã§ã‚‚ä½¿ã„ãŸã„ã®ã§å®Ÿè£…ã™ã‚‹

Railsã§ãªã„(`activesupport`ãŒä½¿ç”¨ã§ããªã„) çŠ¶æ…‹ã®å ´åˆã€ä»¥ä¸‹ã®ã‚ˆã†ã«`parent`ãƒ¡ã‚½ãƒƒãƒ‰ãŒãªã„ã‚ˆã¨æ€’ã‚‰ã‚Œã¦ã—ã¾ã†ã€‚

```
irb(main):008:0> Parent::Child.parent_value
Traceback (most recent call last):
        5: from /Users/shingo.sasaki/.rbenv/versions/2.6.5/bin/irb:23:in `<main>'
        4: from /Users/shingo.sasaki/.rbenv/versions/2.6.5/bin/irb:23:in `load'
        3: from /Users/shingo.sasaki/.rbenv/versions/2.6.5/lib/ruby/gems/2.6.0/gems/irb-1.0.0/exe/irb:11:in `<top (required)>'
        2: from (irb):8
        1: from /Users/shingo.sasaki/Docker/teachme/app/libraries/hoge.rb:8:in `parent_value'
NoMethodError (undefined method `parent' for Parent::Child:Module)
```

`activesupport` ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã€‚

```ruby
def parent
  parent_name ? ActiveSupport::Inflector.constantize(parent_name) : Object
end
```

```ruby
def parent_name
  if defined?(@parent_name)
    @parent_name
  else
    parent_name = name =~ /::[^:]+\Z/ ? $`.freeze : nil
    @parent_name = parent_name unless frozen?
    parent_name
  end
end
```

ã¨ã€ã‚³ãƒ¼ãƒ‰ã‚’è¿½ã£ã¦ã„ãã¨ä»¥ä¸‹ã®ã‚ˆã†ãªæ‰‹æ®µã‚’ç”¨ã„ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹

- `Module#name` ã‚’ä½¿ã£ã¦ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã‚’æ–‡å­—åˆ—ã§å–å¾—
- `::` ã‚’å…ƒã«ã€è¦ªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¾ã§ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã‚’æ­£è¦è¡¨ç¾ã§æŠ½å‡º
- `Object.const_get` ã‚’ç”¨ã„ã¦æ–‡å­—åˆ—ã‹ã‚‰ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å–å¾—

ã‚ˆã£ã¦ã€`Module`ã‚¯ãƒ©ã‚¹è‡ªä½“ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ‹¡å¼µã™ã‚Œã°è¿‘ã„ã“ã¨ãŒã§ãã‚‹(ã‚·ãƒ³ãƒ—ãƒ«ã•ã‚’é‡è¦–ã—ã¦ã€å®Ÿéš›ã®`activesupport`ã»ã©æ‰‹åºƒãã‚«ãƒãƒ¼ã—ã¦ã¾ã›ã‚“)

```ruby
class Module
  def parent
    parent_name = self.name =~ /::[^:]+\Z/ ? $`.freeze : nil
    parent_name ? Object.const_get(parent_name) : Object
  end
end
```

â†‘ã‚’èª­ã¿è¾¼ã‚“ã çŠ¶æ…‹ãªã‚‰ã“ã‚“ãªæ§‹é€ ãŒã‚ã£ã¦ã‚‚

```ruby
module Parent
  module Child
    module GrandChild
    end
  end
end
```

éšŽå±¤ã‚’ãŸã©ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹

```ruby
[3] pry(main)> Parent::Child::GrandChild.parent
=> Parent::Child
[4] pry(main)> Parent::Child::GrandChild.parent.parent
=> Parent
[5] pry(main)> Parent::Child::GrandChild.parent.parent.parent
=> Object
```
