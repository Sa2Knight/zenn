---
title: "Storybook ã¨ react-docgen ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹"
emoji: "ğŸ“•"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Storybook", "React"]
published: false
---

# æ¦‚è¦

æœ¬è¨˜äº‹ã¯ã€[SmartHR Advent Calendar 2023](https://qiita.com/advent-calendar/2023/smarthr) ã®ã‚·ãƒªãƒ¼ã‚º2ã®7æ—¥ç›®ã§ã™ã€‚

æœ¬è¨˜äº‹ã§ã¯ã€Storybook ã‚’ [React](https://ja.react.dev/blog/2023/03/16/introducing-react-dev) ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ç”¨ã—ãŸå ´åˆã«å†…éƒ¨çš„ã«åˆ©ç”¨ã•ã‚Œã‚‹ [react-docgen](https://github.com/reactjs/react-docgen) åŠã³ [react-docgen-typescript](https://github.com/styleguidist/react-docgen-typescript) ã«ã¤ã„ã¦ç´¹ä»‹ã—ã€ãã®ä»•çµ„ã¿ã‚’æ·±ã¼ã‚‹ã“ã¨ã§ Storybook ã®ç†è§£ã‚’æ·±ã‚ã‚‹ã‚ˆã†ã¨ã„ã†è¨˜äº‹ã§ã™ã€‚

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±

- Storybook v7.6.3 (monorepo)
- react-docgen v7.0.1

# Storybook 7.6.0 ã®ãƒªãƒªãƒ¼ã‚¹

å…ˆæ—¥ã€Storybook v7.6.0 ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã€ä»¥ä¸‹ãƒ–ãƒ­ã‚°ã«ã¦ãƒªãƒªãƒ¼ã‚¹å†…å®¹ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
https://storybook.js.org/blog/storybook-7-6/

v7.6.0 ã¯ã€å„ç¨®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨UXã®æ”¹å–„ã€åŠ ãˆã¦æ¬¡ã®ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å‘ã‘ãŸãƒ¬ã‚¬ã‚·ãƒ¼æ©Ÿèƒ½ã®éæ¨å¥¨åŒ–ãŒä¸­å¿ƒã¨ãªã£ã¦ãŠã‚Šã€ããŸã‚‹ v8 ã«ã‚€ã‘ãŸ v7 æœ€å¾Œã®ãƒ‘ãƒƒãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ãªã‚Šã¾ã™ã€‚

æœ¬è¨˜äº‹ã§ã¯ã€ä¸Šè¨˜ãƒ–ãƒ­ã‚°å†…ã§å–ã‚Šä¸Šã’ã‚‰ã‚Œã¦ã„ã‚‹ã€**react-docgen upgrade** ã«ã¤ã„ã¦æ·±æ˜ã‚Šã—ã¾ã™ã€‚

> **react-docgen upgrade**
>
> A major performance upgrade in Storybook 8 will be the switch to react-docgen for autogenerated controls. This might sound small but it will speed up startup times by 2x or more.

ã©ã†ã‚„ã‚‰ããŸã‚‹ Storybook v8 ã§ã¯ã€ãªã‚“ã‚‰ã‹ã®ãƒ„ãƒ¼ãƒ«ã‚’ `react-docgen` ã«ä¹—ã‚Šæ›ãˆã‚‹ã“ã¨ã§ã€(React ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã‘ã‚‹) åˆå›èµ·å‹•æ™‚é–“ãŒåŠåˆ†ã«ãªã‚‹ã“ã¨ãŒè¦‹è¾¼ã‚ã‚‹ãã†ã§ã™ã€‚

ä¹—ã‚Šæ›ãˆå…ƒãƒ„ãƒ¼ãƒ«ãŒä½•ãªã®ã‹ã€ä½•ãŸã‚ã«ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã‹ã¯ã€[MIGRATION.md](https://github.com/storybookjs/storybook/blob/next/MIGRATION.md) ã‹ã‚‰ç¢ºèªã§ãã¾ã—ãŸã€‚

https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#react-docgen-component-analysis-by-default

> **React-docgen component analysis by default**
>
> In Storybook 7, we used react-docgen-typescript to analyze React component props and auto-generate controls. In Storybook 8, we have moved to react-docgen as the new default.

ã“ã‚Œã«ã‚ˆã‚‹ã¨ã€`Controls` ã«è¡¨ç¤ºã™ã‚‹ React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿(propsã®å‹å®šç¾©ãªã©)ã‚’è§£æã™ã‚‹ãŸã‚ã«ã€ã“ã‚Œã¾ã§ã¯ `react-docgen-typescript` ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã—ãŸãŒã€Storybook 8 ã‹ã‚‰ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ `react-docgen` ãŒä½¿ç”¨ã•ã‚Œã‚‹ã‚ˆã†ã«å¤‰ã‚ã‚‹ãã†ã§ã™ã€‚

ãªãŠã€ `Controls` ã¨ã¯ã€Storybook ã«ãŠã‘ã‚‹ä¸»è¦æ©Ÿèƒ½ã®ä¸€ã¤ã§ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® Props ã‚’ç”»é¢ä¸Šã‹ã‚‰å·®ã—æ›¿ãˆã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«æç”»çµæœã‚’ç¢ºèªã§ãã‚‹ä»•çµ„ã¿ã§ã™ã€‚(ä»¥ä¸‹gifå‚ç…§)

![](https://storage.googleapis.com/zenn-user-upload/19a285efe8ea-20231204.gif)

`react-docgen`(å¾Œè¿°) ã¯ã€å…ƒã€… TypeScript ã«å¯¾å¿œã—ã¦ã„ãªã‹ã£ãŸãŸã‚ã€TypeScript å¯¾å¿œç‰ˆã¨ã—ã¦ `react-docgen-typescript` ãŒé–‹ç™ºã•ã‚Œã¾ã—ãŸãŒã€ç¾åœ¨ã§ã¯ `react-docgen` ã§ã‚‚æœ€ä½é™ ã® TypeScript ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«ãªã£ãŸãŸã‚ã€ä¹—ã‚Šæ›ãˆå¯èƒ½ã«ãªã£ãŸã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚

MIGRATION.md ã«ã¯ä»¥ä¸‹ã®è¨˜è¼‰ã‚‚ã‚ã‚Šã¾ã—ãŸã€‚

> react-docgen is dramatically more efficient, shaving seconds off of dev startup times. However, it only analyzes basic TypeScript constructs.
> We feel react-docgen is the right tradeoff for most React projects. However, if you need the full fidelity of react-docgen-typescript, you can opt-in using the following setting in .storybook/main.js:

- `react-docgen` ã¯é«˜é€Ÿã ãŒã‚·ãƒ³ãƒ—ãƒ«
- `react-docgen-typescript` ã¯ä½é€Ÿã ãŒå¤šæ©Ÿèƒ½

ã®é•ã„ãŒã‚ã‚‹ãŸã‚ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã£ã¦ä½¿ã„åˆ†ã‘ã‚‹ã®ãŒé‡è¦ãªã‚ˆã†ã§ã™ã€‚

ã¾ãŸã€`react-docgen-typescript` ã¯æœ€çµ‚ãƒªãƒªãƒ¼ã‚¹ãŒ 2021å¹´12æœˆã§ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒè¡Œã‚ã‚Œã¦ã„ãªã„æ—¨ã‚‚ä»¥ä¸‹ Issue ã‹ã‚‰ã‚‚ç¢ºèªã§ãã‚‹ãŸã‚ã€ãã†ã„ã£ãŸèƒŒæ™¯ã‹ã‚‰ã‚‚é–‹ç™ºãŒæ´»ç™ºãª `react-docgen` ã‚’æ¡ç”¨ã—ãŸã¨æ€ãˆã¾ã™ã€‚

https://github.com/styleguidist/react-docgen-typescript/issues/494

Storybook ä¸Šã§ä½¿ç”¨ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®åˆ‡ã‚Šæ›¿ãˆã¯ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«å‡ºæ¥ã¾ã™ã€‚

```ts
export default {
  typescript: {
    reactDocgen: 'react-docgen', // or react-docgen-typescript
  }
}
```

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æŒ‡å®šãŒãªã„å ´åˆã€Storybook ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å¿œã˜ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

|Storybook|ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸|
|---|---|
|7.5.0|`react-docgen-typescript`|
|7.6.0|`react-docgen-typescript`|
|8.0.0|`react-docgen`|

ã“ã“ã‹ã‚‰ã¯ã€ä»Šå¾Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ãªã‚‹ `react-docgen` ã«ã¤ã„ã¦æ·±æ˜ã‚Šã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

# react-docgen ã«ã¤ã„ã¦

æ”¹ã‚ã¾ã—ã¦ã€[react-docgen](https://github.com/reactjs/react-docgen) ã¯ã€React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã€Props ã®å‹å®šç¾©ãªã©ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã€JSON ãªã©ã§å‡ºåŠ›ã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

https://github.com/reactjs/react-docgen

ä¾‹ã¨ã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãª TypeScript ã§æ›¸ã‹ã‚ŒãŸ React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

```ts
import React from 'react'

type Props = {
  literal: "foo" | "bar" | "baz";
  object: {
    foo?: string;
    bar: number;
  };
  array?: Array<number | string>;
  func: (foo: string) => number;
};

/**
  Sample Component
**/
export const MyComponent: React.FC<Props> = ({ literal, object, array = [], func }) => {
  return <div>MyComponent</div>
};

```

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒè§£æã•ã‚Œã€ä»¥ä¸‹ã®ã‚ˆã†ãª JSON ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```json
[
  {
    "description": "Sample Component",
    "displayName": "MyComponent",
    "methods": [],
    "props": {
      "literal": {
        "required": true,
        "tsType": {
          "name": "union",
          "raw": "\"foo\" | \"bar\" | \"baz\"",
          "elements": [
            {
              "name": "literal",
              "value": "\"foo\""
            },
            {
              "name": "literal",
              "value": "\"bar\""
            },
            {
              "name": "literal",
              "value": "\"baz\""
            }
          ]
        },
        "description": ""
      },
      "object": {
        "required": true,
        "tsType": {
          "name": "signature",
          "type": "object",
          "raw": "{\n  foo?: string;\n  bar: number;\n}",
          "signature": {
            "properties": [
              {
                "key": "foo",
                "value": {
                  "name": "string",
                  "required": false
                }
              },
              {
                "key": "bar",
                "value": {
                  "name": "number",
                  "required": true
                }
              }
            ]
          }
        },
        "description": ""
      },
      "array": {
        "required": false,
        "tsType": {
          "name": "Array",
          "elements": [
            {
              "name": "union",
              "raw": "number | string",
              "elements": [
                {
                  "name": "number"
                },
                {
                  "name": "string"
                }
              ]
            }
          ],
          "raw": "Array<number | string>"
        },
        "description": "",
        "defaultValue": {
          "value": "[]",
          "computed": false
        }
      },
      "func": {
        "required": true,
        "tsType": {
          "name": "signature",
          "type": "function",
          "raw": "(foo: string) => number",
          "signature": {
            "arguments": [
              {
                "type": {
                  "name": "string"
                },
                "name": "foo"
              }
            ],
            "return": {
              "name": "number"
            }
          }
        },
        "description": ""
      }
    }
  }
]
```

ä¸Šè¨˜ã®é€šã‚Šã€ React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å†…ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹æƒ…å ±ã‹ã‚‰ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒæŠ½å‡ºã§ãã¾ã™ã€‚

- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆ
- Props
  - required or optional
  - å‹æƒ…å ±
  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
  - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆ

`react-docgen-typescript` ã¨æ¯”ã¹ã‚‹ã¨æ©Ÿèƒ½ãŒé™ã‚‰ã‚Œã‚‹ã¨ã¯è¨€ã‚ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã‚Œã ã‘è¦‹ã‚‹ã¨ååˆ†å®Ÿç”¨çš„ãã†ã§ã™ã­ã€‚

ãªãŠã€ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã¯ [Playground](https://react-docgen.dev/playground) ã‚’ç”¨ã„ã¦ç”Ÿæˆã—ã¾ã—ãŸãŒã€CLI ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§æ‰‹å…ƒã§ã‚‚ç¢ºèªå¯èƒ½ã§ã™ã€‚

```bash
$ yarn add -D @react-docgen/cli
$ yarn react-docgen hoge.ts -o result.json --pretty
```